cache:
  paths:
    - maven.repository/

variables:
  MAVEN_OPTS: '-Dmaven.repo.local=maven.repository/'

stages:
  - build

branch_build:
  stage: build
  image: maven:3-jdk-7
  except:
    - tags
  script:
    - mvn -B -U -s .ci_settings.xml clean verify

tag_build:
  stage: build
  image: registry.gitlab.com/intergral/docker/build-images/maven-3:external-gpg-java-7
  only:
    - tags
  script:
    - mvn -B -U -s .ci_settings.xml versions:set -DnewVersion=${CI_COMMIT_TAG}
    - mvn -B -U -s .ci_settings.xml clean deploy -p release-ossrh
